## 啥是同源策略

同源策略是指：在浏览器中，一个源的文档访问另外一个源的文档时，需要符合同源。

所谓同源是指：协议、域名、端口三者都要一样。

而所谓的文档访问，常见的有这几种：

- 读取 Cookie/LocalStorage
- 发起 Ajax 请求
- 访问 DOM

其中最最常见的，就是 Ajax 请求。同源策略规定发起 Ajax 请求所在的网页和服务端必须同源。

当然，同源策略都是*针对浏览器*来说的，服务器和服务器之间是不存在什么同源策略的，这也就是类似 devServer 这样的代理能大行其道的原因。

注意：图片、script、css 是可以无视同源策略的。

## 跨域解决之道，jsonp vs CORS

jsonp，是一种没有太大作用的跨域请求手段。它实现的原理如下：

1. 客户端利用 script 脚本可以绕开同源策略限制的特点，来向服务器发送请求；
2. 在请求中携带回调函数名，同时在本地也定义好该回调函数；
3. 服务器读取该回调函数名，并将结果传入回调函数中发回给客户端（相当于是服务端动态拼接内容）；
4. 客户端收到结果后执行回调函数，就拿到了请求结果。

一个典型的 jsonp 请求如下：

```js
<script src="http://www.baidu.cn/login?username=zhangnan&callback=myCallback"></script>
```

jsonp 至少有两个非常明显的缺点：

- 只能支持 get 请求，不能支持其他类型请求如 post;
- 需要服务端配合，服务端要写代码读取请求中的回调函数名（那为什么不直接设置 CORS?）。

真正能从根本上解决问题的，还得是 CORS。

服务器通过设置`Access-Control-Allow-Origin`来开启 CORS，它可以配置允许哪些源可以访问自己的服务，且支持所有类型的 http 请求。
