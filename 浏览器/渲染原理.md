## CSS 的加载会不会造成阻塞

**CSS 的加载不会阻塞 DOM 解析，但会阻塞 Render Tree 渲染。**

其实这个原理也很简单：Render Tree 是由 DOM Tree 和 CSSOM 组合形成的，所以它必须等到 DOM Tree 和 CSSOM 两个都加载完，才能进行合成。

而 DOM Tree 和 CSSOM 是并行构建、分头行动、互不影响的。

## 为什么有时候JS需要等待CSS文件的下载完成

简而言之：**JS可能要获取CSS内容**。

首先，JS文件和CSS文件是同时下载的，有时候JS下载得快，有时候CSS下载得快。

假设JS先下载完，由于浏览器并不能提前感知JS脚本的内容是干了啥，所以这时候不等待CSS下载完成，直接执行JS会有风险。比如：通过JS获取某个div的背景颜色和字体大小等，如果这些东西写在CSS样式表里，那么JS不等待CSS下载完成就直接执行，获取的背景颜色和字体大小就是错误的。

## 为什么建议把CSS放头部（head）？

把CSS放头部，可以尽早生成CSSOM，等到DOM Tree生成完时直接合并成Render Tree。

否则，如果放在body内部，容易出现执行到这里的时候，发现有CSS代码，从而加载生成CSSOM，重新合成Render Tree引起回流，导致页面出现“样式突变”。

## 为什么建议JS放在body尾部？

因为js会阻塞渲染，放在尾部执行可以让能渲染出来的HTML元素先渲染出来，减少首屏时间。

## 图片会不会阻塞渲染？

不会。

## DOMContentLoaded和window.onload的区别

正如名字说的那样，DOMContentLoaded指的是DOM渲染完了就执行，此时图片、视频等外部资源可能还没加载完；

而window.onload指的是页面的全部资源加载完了才执行，包括图片、视频那些。

如果我们要在页面加载完后去做一些事情，一般监听DOMContentLoaded就行了，因为我们监听页面加载完后去做的事情**往往都跟DOM相**关。至于图片、视频有没有全部下载完，我们是很少关心的。

## 在地址栏输入一个 URL 时，具体发生了什么？（很具体的那种）

### 资源形式有哪些

我们输入URL，实际上是在向服务器请求资源，资源有哪些种类呢？

1. html文件，这个最常见
2. 一些媒体文件，比如说图片、视频等
3. js、css


### 大体步骤

我们可以把这里分为五部分，以后我们讨论这个问题答案就是五部分，天王老子来了它也是五部分：

1. DNS解析
2. TCP连接
3. 客户端发送HTTP请求
4. 服务器响应HTTP请求
5. 浏览器解析渲染

### 第一部分 DNS解析

其实在这步之前，还有两个过程：就是构建网络请求，以及查找浏览器缓存（强缓存/协商缓存）。

在构建网络请求之前，有一个动作捕获的过程，UI线程会捕捉地址栏中的地址栏内容，然后网络线程会负责对地址栏内容做前置处理，比如说是关键字的话，就移交给搜索引擎；是URL的话，就先检查一下是不是恶意站点，如果不是，就移交给DNS做下一步处理。

首先我们搞明白一件事，DNS解析，其实就是：**域名转换为IP地址的过程**。这里是不涉及端口号的。

它的查找优先级是这样的：

1. 本地DNS缓存；
2. 系统配置的DNS服务器；
3. DNS根服务器。

### 第二部分 TCP连接

在正式发送HTTP请求之前，需要建立TCP连接，这里主要涉及到的就是TCP的三次握手。在TCP那一章已经说了。

如果访问的是接口是HTTPS，那在TCP握手完成之后，还要进行TLS握手。

### 第三部分 浏览器发起http请求

这里会展示一个HTTP请求如何发送，会涉及到TCP/IP协议族的四层模型。

应用层数据 --> 下沉到传输层，添加来源端口和目标端口号 --> 下沉到网络层，加上源IP地址和目标IP地址 --> 下沉到链路层，转成电信号发给服务器。

### 第四部分 服务器处理http请求，并将资源返还给浏览器

服务器要处理这个请求，对请求的处理在TCP/IP协议族中是自下而上的，会经历一个类似“拆快递”的过程，最终将客户端的HTTP请求传给顶层的应用层。然后服务器经过一系列操作（查询数据库之类），将相应资源返还给客户端。

### 第五部分 浏览器解析渲染

如果返回的是html代码，那会经历如下过程：

1. 根据HTML生成DOM Tree；
2. 根据CSS代码生成CSSOM；
3. DOM Tree和CSSOM结合生成Render Tree;
4. 浏览器根据Render Tree渲染页面。（如果遇到script则暂停渲染，执行完script再继续渲染）。

为什么渲染过程中遇到script要优先执行script？*因为JS可能会改变DOM结构*。
